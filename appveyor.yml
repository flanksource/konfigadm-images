version: 1.0.{build}
image: Ubuntu1804

environment:
  matrix:
    - image: ubuntu:1804
      config: capv
    - image: centos:7
      config: capv
    - image: ubuntu:1804
      config: docker
    - image: debian:9
      config: docker
    - image: fedora:30
      config: docker
    - image: centos:7
      config: docker
    - image: ubuntu:1804
      config: containerd
    - image: centos:7
      config: containerd

  GOPATH: /usr/go/
  GO111MODULES: on

build_script:
  - sh: sudo snap install go --classic
  - sh: sudo ./build.sh ${image} ${config}

artifacts:
  - path: images/*
    type: File

deploy:
  release: $(APPVEYOR_REPO_TAG_NAME)
  provider: GitHub
  auth_token:
    secure: iO9qBR19uG7zvP2ocrkrn35YTchFxm0G0stLeZ/AVeY3RAIXoUt5Q1H9nGiCN6Ao
  artifact: /.*/
  draft: false
  prerelease: false
  on:
    APPVEYOR_REPO_TAG: true
